<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./assets/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
  <title>Book</title>
</head>
<body>
  <div class="main">
    <div class="diary">
      <div class="pre-diary open"></div>   <!-- remember to add open -->
      <div class="pre-fake-background hidden"></div> 
      <div class="main-diary hidden"> <!-- remember to add hidden -->
        
        <div class="page-1">  
          <div class="diary-content-1 ml20">
            <img src="./assets/image/img1_1.jpg" data-img-id="img1_1" alt="" class="diary-img img-vertical">         
          </div>
          <div class="diary-content-2 ml20">
            <img src="./assets/image/img1_5.jpg" data-img-id="img1_5" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml90">
            <img src="./assets/image/img1_3.jpg" data-img-id="img1_3" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-4 ml90">
            <img src="./assets/image/img1_6.jpg" data-img-id="img1_6" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img1_2.jpg" data-img-id="img1_2" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img1_4.jpg" data-img-id="img1_4" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-2">  
          <div class="diary-content-1 ml20">
            <img src="./assets/image/img2_1.jpg" data-img-id="img2_1" alt="" class="diary-img img-horizontal">         
          </div>
          <div class="diary-content-2 ml20">
            <img src="./assets/image/img2_2.jpg" data-img-id="img2_2" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml90">
            <img src="./assets/image/img2_3.jpg" data-img-id="img2_3" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-4 ml90">
            <img src="./assets/image/img2_6.jpg" data-img-id="img2_6" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img2_5.jpg" data-img-id="img2_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img2_4.jpg" data-img-id="img2_4" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-3">  
          <div class="diary-content-1 ml20">
            <img src="./assets/image/img3_1.jpg" data-img-id="img3_1" alt="" class="diary-img img-horizontal">         
          </div>
          <div class="diary-content-2 ml20">
            <img src="./assets/image/img3_2.jpg" data-img-id="img3_2" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-3 ml90">
            <img src="./assets/image/img3_3.jpg" data-img-id="img3_3" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-4 ml210">
            <video src="./assets/image/vid3_4.mp4" data-img-id="vid3_4" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img3_5.jpg" data-img-id="img3_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img3_6.jpg" data-img-id="img3_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-4">  
          <div class="diary-content-1 ml20">
            <video src="./assets/image/vid4_1.mp4" data-img-id="vid4_1" alt="" class="diary-img img-horizontal">         
          </div>
          <div class="diary-content-2 ml20">
            <video src="./assets/image/vid4_2.mp4" data-img-id="vid4_2" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml90">
            <img src="./assets/image/img4_3.jpg" data-img-id="img4_3" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-4 ml210">
            <img src="./assets/image/img4_4.jpg" data-img-id="img4_4" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img4_5.jpg" data-img-id="img4_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img4_6.jpg" data-img-id="img4_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-5">  
          <div class="diary-content-1 ml210">
            <img src="./assets/image/img5_1.jpg" data-img-id="img5_1" alt="" class="diary-img img-vertical">         
          </div>
          <div class="diary-content-2 ml210">
            <img src="./assets/image/img5_2.jpg" data-img-id="img5_2" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-3 ml90">
            <video src="./assets/image/vid5_3.mp4" data-img-id="vid5_3" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-4 ml20">
            <img src="./assets/image/img5_4.jpg" data-img-id="img5_4" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img5_5.jpg" data-img-id="img5_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml90">
            <video src="./assets/image/vid5_6.mp4" data-img-id="vid5_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-6">  
          <div class="diary-content-1 ml20">
            <img src="./assets/image/img6_6.jpg" data-img-id="img6_6" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-2 ml20">
            <img src="./assets/image/img6_4.jpg" data-img-id="img6_4" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml90">
            <img src="./assets/image/img6_3.jpg" data-img-id="img6_3" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-4 ml210">
            <video src="./assets/image/vid6_2.mp4" data-img-id="vid6_2" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img6_5.jpg" data-img-id="img6_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img6_1.jpg" data-img-id="img6_1" alt="" class="diary-img img-vertical">         
          </div>
        </div>

        <div class="page-7">  
          <div class="diary-content-1 ml20">
            <img src="./assets/image/img7_1.jpg" data-img-id="img7_1" alt="" class="diary-img img-vertical">         
          </div>
          <div class="diary-content-2 ml20">
            <img src="./assets/image/img7_2.jpg" data-img-id="img7_2" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml90">
            <video src="./assets/image/vid7_3.mp4" data-img-id="vid7_3" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-4 ml90">
            <img src="./assets/image/img7_4.jpg" data-img-id="img7_4" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img7_5.jpg" data-img-id="img7_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <video src="./assets/image/vid7_6.mp4" data-img-id="vid7_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-8">  
          <div class="diary-content-1 ml20">
            <img src="./assets/image/img8_1.jpg" data-img-id="img8_1" alt="" class="diary-img img-horizontal">         
          </div>
          <div class="diary-content-2 ml210">
            <img src="./assets/image/img8_2.jpg" data-img-id="img8_2" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-3 ml90">
            <img src="./assets/image/img8_3.jpg" data-img-id="img8_3" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-4 ml90">
            <img src="./assets/image/img8_4.jpg" data-img-id="img8_4" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img8_5.jpg" data-img-id="img8_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <video src="./assets/image/vid8_6.mp4" data-img-id="vid8_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-9">  
          <div class="diary-content-1 ml210">
            <img src="./assets/image/img9_1.jpg" data-img-id="img9_1" alt="" class="diary-img img-vertical">         
          </div>
          <div class="diary-content-2 ml20">
            <video src="./assets/image/vid9_2.mp4" data-img-id="vid9_2" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml20">
            <img src="./assets/image/img9_3.jpg" data-img-id="img9_3" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-4 ml90">
            <img src="./assets/image/img9_4.jpg" data-img-id="img9_4" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-5 ml210"> 
            <img src="./assets/image/img9_5.jpg" data-img-id="img9_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img9_6.jpg" data-img-id="img9_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-10">  
          <div class="diary-content-1 ml20">
            <img src="./assets/image/img10_1.jpg" data-img-id="img10_1" alt="" class="diary-img img-horizontal">         
          </div>
          <div class="diary-content-2 ml20">
            <video src="./assets/image/vid10_2.mp4" data-img-id="vid10_2" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml90">
            <img src="./assets/image/img10_3.jpg" data-img-id="img10_3" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-4 ml90">
            <img src="./assets/image/img10_4.jpg" data-img-id="img10_4" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-5 ml210"> 
            <video src="./assets/image/vid10_5.mp4" data-img-id="vid10_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <video src="./assets/image/vid10_6.mp4" data-img-id="vid10_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-11">  
          <div class="diary-content-1 ml210">
            <video src="./assets/image/vid11_1.mp4" data-img-id="vid11_1" alt="" class="diary-img img-vertical">         
          </div>
          <div class="diary-content-2 ml90">
            <img src="./assets/image/img11_2.jpg" data-img-id="img11_2" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-3 ml20">
            <img src="./assets/image/img11_3.jpg" data-img-id="img11_3" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-4 ml210">
            <video src="./assets/image/vid11_4.mp4" data-img-id="vid11_4" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-5 ml210"> 
            <video src="./assets/image/vid11_5.mp4" data-img-id="vid11_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img11_6.jpg" data-img-id="img11_6" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="page-12">  
          <div class="diary-content-1 ml210">
            <video src="./assets/image/vid12_1.mp4" data-img-id="vid12_1" alt="" class="diary-img img-vertical">         
          </div>
          <div class="diary-content-2 ml20">
            <img src="./assets/image/img12_2.jpg" data-img-id="img12_2" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-3 ml20">
            <img src="./assets/image/img12_3.jpg" data-img-id="img12_3" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-4 ml90">
            <video src="./assets/image/vid12_6.mp4" data-img-id="vid12_6" alt="" class="diary-img img-horizontal">
          </div>
          <div class="diary-content-5 ml210"> 
            <video src="./assets/image/vid12_5.mp4" data-img-id="vid12_5" alt="" class="diary-img img-vertical">
          </div>
          <div class="diary-content-6 ml20">
            <img src="./assets/image/img12_4.jpg" data-img-id="img12_4" alt="" class="diary-img img-vertical">
          </div>
        </div>

        <div class="next-page navigation"></div>
        <div class="prev-page navigation"></div>
      </div>

      <div class="img-description-container hidden">
        <div class="img-description">
          <!-- <div class="img-description-main-item-container">
            <img src="./assets/image/1-1.jpg" alt="" class="">
          </div>
          <div class="img-description-content">XIN CHÀO MNNNNNNNNNNNNNNNNNNNNNNNNNNN</div>
          <div class="img-description-slider">
            <div class="img-description-items"><img src="./assets/image/1-4.JPG" alt=""></div>
            <div class="img-description-items"><img src="./assets/image/1-4.JPG" alt=""></div>
            <div class="img-description-items"><img src="./assets/image/1-4.JPG" alt=""></div>
            <div class="img-description-items"><img src="./assets/image/1-4.JPG" alt=""></div>
          </div> -->
        </div> 
      </div>

      <div class="main-fake-background hidden"></div>       <!-- nho add hidden  -->
      <div class="post-diary hidden"></div>
      <div class="flash-bang"></div>   
    </div>
  </div>
</body>

<script>
  const $ = document.querySelector.bind(document)
  const $$ = document.querySelectorAll.bind(document)
  const web = {
    currentPage: 0,
    imgList: 
    {
      img1_1:
      {
        content: '',
      },
      img1_2:
      {
        content: '',
      },
      img1_3:
      {
        content: '',
      },
      img1_4:
      {
        content: '',
      },
      img1_5:
      {
        content: '',
      },
      img1_6:
      { 
        content: '',
        subImg: ["./assets/image/img1_6a.jpg","./assets/image/img1_6b.jpg"],
      },
      img2_1:
      {
        content: '',
      },
      img2_2:
      {
        content: '',
      },
      img2_3:
      {
        content: '',
      },
      img2_4:
      {
        content: '',
      },
      img2_5:
      {
        content: '',
      },
      img2_6:
      { 
        content: '',
      },
      img3_1:
      {
        content: '',
      },
      img3_2:
      {
        content: '',
        subImg: ["./assets/image/vid3_2a.mp4"],
      },
      img3_3:
      {
        content: '',
      },
      vid3_4:
      {
        content: '',
      },
      img3_5:
      {
        content: '',
        subImg: ["./assets/image/img3_5a.jpg"],
      },
      img3_6:
      { 
        content: '',
      },
      vid4_1:
      {
        content: '',
      },
      vid4_2:
      {
        content: '',
      },
      img4_3:
      {
        content: '',
      },
      img4_4:
      {
        content: '',
      },
      img4_5:
      {
        content: '',
        subImg: ["./assets/image/img4_5a.jpg", "./assets/image/img4_5b.mp4"],
      },
      img4_6:
      { 
        content: '',
      },


    },

    handleEvent: function(){
      const _this = this

      const diaryCover = $('.pre-diary')
      const preFakeBg = $('.pre-fake-background')

      const mainDiary = $('.main-diary')

      const diaryImgList = $$('.diary-img')
      // const diaryParList = $$('.diary-par')

      const navigationPage = $$('.navigation')
      const nextPageElement = $('.next-page')
      const prevPageElement = $('.prev-page')

      const imgMenuContainer = $('.img-description-container')
      const imgMenu = $('.img-description')
      const subImgItem = $$('.img-description-items img')


      //open book
      diaryCover.onclick = function() {
        //Them hieu ung mo quyen sach
        _this.addingStyle(diaryCover, 'animation', 'ToTheRight 1s linear, LatSach1 3s 1s linear')

        //Sau 3s(tuc la khi book dung im) hiện flash và sau 6s ẩn element và hiện Page1
        setTimeout(()=>{
          _this.flashBang('Out')
          preFakeBg.classList.remove('hidden');
          _this.nextPage(diaryCover)
        }, 1000)

        //Sau 6s hiện flash và xuất hiện Page1
        setTimeout(() => {
          _this.flashBang('In')
          preFakeBg.classList.add('hidden');
        }, 4000);   
      }

      //Handle navigation page
      for(let i = 0; i < navigationPage.length; i++) {
        navigationPage[i].onclick = function(){
          //Xác định xem đó là next page hay prev page
          let navigationElement = _this.defineNavigationPageElement(navigationPage[i])

          //Thêm hiệu ứng lật sách và flash
          _this.addingStyle(navigationElement, 'animationName', `LatSach${navigationElement === nextPageElement ? 2 : 3}`)
          _this.flashBang('Out')

          //Sau 3s lại flash và hiện Page2
          setTimeout(() => {
            _this.flashBang('In')
            _this.resetStyle(navigationElement, 'animationName')
          }, 3000); 

          if(navigationElement === nextPageElement) _this.nextPage()
          else _this.prevPage(diaryCover, preFakeBg ,mainDiary)
        }
      }
      
      imgMenuContainer.onclick = function(e) {
        e.target.classList.add('hidden')
      }
      imgMenu.onclick = function(e) {
        e.stopPropagation()
      }

      for(let i = 0; i <= diaryImgList.length; i++) {
        if(diaryImgList[i]) {
          diaryImgList[i].onclick = function() {
            imgMenuContainer.classList.remove('hidden')
            _this.openImgMenu(diaryImgList[i].getAttribute('data-img-id'), diaryImgList[i])
          }
        }       
      }

      for(let i = 0; i <= subImgItem.length; i++) {
        if(subImgItem[i])
        subImgItem[i].onclick = function(e) {
          console.log(subImgItem)
          _this.changeSubImg(e.target)
        }
      }

      if($('.test'))
      $('.test').onclick = function(e) {
          console.log($('.test'))
          _this.changeSubImg(e.target)
        }
    },

    // Chuyen trang
    nextPage: function(notPageElement) {
      const pageList = $$(`[class*='page-']`)
      const mainDiary = $('.main-diary')

      //chia t/hop neu element la bia sach 
      let currentPageElement = this.currentPage === 0 ? notPageElement : pageList[this.currentPage - 1]

      this.addingStyle(currentPageElement, 'opacity', 0)

      setTimeout(() => {
        currentPageElement.classList.remove(`${currentPageElement.classList.contains('open') ? 'open' : 'open-page'}`)

        this.currentPage++

        //Nếu là bìa sách thì cho hiện mainDiary
        if(notPageElement) mainDiary.classList.remove('hidden')
        //Còn không thì hiện page tiếp theo
        pageList[this.currentPage - 1].classList.add('open-page')
        //Trả lại opacity cho element trước đó
        this.addingStyle(currentPageElement, 'opacity', 1)

      }, 3000);
    },

    // Lui trang
    prevPage: function(diaryCover, preFakeBg, mainDiary, behindPage) { //cho function này nhận những value trong hàm handle mà không cần phải đặt biến lại
      const pageList = $$(`[class*='page-']`)

      let currentPageElement = pageList[this.currentPage - 1]

      this.addingStyle(currentPageElement, 'opacity', 0)

      setTimeout(() => {
        currentPageElement.classList.remove('open-page' || 'open')          
        //Nếu là page1 thì sẽ chuyển về bìa sách
        if(this.currentPage === 1 )
        {
          diaryCover.classList.add('open')
          mainDiary.classList.add('hidden')
          this.addingStyle(diaryCover, 'animation', 'none')
          this.currentPage--
        }
        else 
        {
          this.currentPage--
          pageList[this.currentPage - 1].classList.add('open-page') //còn không phải thì mở trang trước đó
        }

        //Reset opacity
        this.resetStyle(currentPageElement, 'opacity') //Có thể dùng destructuring nhma mình đ nhớ

      }, 3000);
    },

    //Hàm dùng để xác định prev hay next
    defineNavigationPageElement: function(element) {
      const nextPageElement = $('.next-page')
      const prevPageElement = $('.prev-page')

      if(element === nextPageElement) return nextPageElement
      else return prevPageElement
    },

    openImgMenu: function(imgId, imgElement) {
      const imgMenu = $('.img-description')
      let typeOfElement = imgId.includes('img') ? 'img' : 'video' //Ktra cái đó là img hay vid
      let isVertical = imgElement.classList.contains('img-vertical')
      setTimeout(()=>{
        if(typeOfElement === 'video') imgElement.pause()
      }, 100)
      let subImgList = []
      let subImgHTML = ''
      if(this.imgList[imgId].subImg) {
        for(let i = 0; i < this.imgList[imgId].subImg.length; i++) {
          subImgList.push(`<div class="img-description-items"><${typeOfElement} src="${this.imgList[imgId].subImg[i]}" class="test" alt=""></div>`)
        }
        subImgHTML = subImgList.join('')
      }

      imgMenu.innerHTML = `
          <div class="img-description-main-item-container">
            <${typeOfElement} ${typeOfElement === 'video' ? 'muted autoplay loop' : ''} src="./assets/image/${imgId}.${typeOfElement === 'img' ? 'jpg' : 'mp4'}" alt="" class="${isVertical ? 'img-vertical' : 'img-description-horizontal'}">
          </div>
          <div class="img-description-content">${(this.imgList[imgId]) ? this.imgList[imgId].content : ''}</div>
          <div class="img-description-slider"> 
            ${subImgHTML}
          </div>
      `


      // this.renderImgMenu(typeOfElement, subImgHTML)

     

    },

    changeSubImg: function(clickedSubImg) {
      let typeOfElement = clickedSubImg.getAttribute('src').contains('mp4') ? 'video' : 'img'
      let clickedSubImgAddress = clickedSubImg.closest('.img-description-items')

      let currentSubImg = $('.img-description-main-item-container').querySelector('img')

      $('.img-description-main-item-container').innerHTML = 
      `
        <${typeOfElement} ${typeOfElement === 'video' ? 'muted autoplay loop' : ''} src="./assets/image/${imgId}.${typeOfElement === 'img' ? 'jpg' : 'mp4'}" alt='' class='img-description-horizontal'}">
      `
      clickedSubImgAddress.innerHTML = `<${currentSubImg.getAttribute('src').contains('mp4') ? 'video' : 'img'} src="${currentSubImg.getAttribute('src')}" alt="">`

      
    },

    resetStyle: function(element, style) {
      switch(style){
        case 'opacity': this.addingStyle(element, style, 1);
        case 'animationName': this.addingStyle(element, style, 'none');
      }
    },

    //Hàm tạo flash
    flashBang:function(inOrOut){
      const flashBang = $('.flash-bang')

      this.addingStyle(flashBang, 'animationName', `Flash${inOrOut}`)
    },

    //Hàm thêm style
    addingStyle:function(selector, urStyle, value){
      selector.style[urStyle] = `${value}`
    },

    start:function(){
      this.handleEvent()

    }
  }

  web.start()
</script>
</html>